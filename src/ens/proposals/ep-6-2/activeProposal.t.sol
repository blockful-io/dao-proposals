// SPDX-License-Identifier: MIT
pragma solidity ^0.8.13;

import { Test } from "@forge-std/src/Test.sol";
import { console2 } from "@forge-std/src/console2.sol";

import { IToken } from "@ens/interfaces/IToken.sol";
import { IGovernor } from "@ens/interfaces/IGovernor.sol";
import { ITimelock } from "@ens/interfaces/ITimelock.sol";
import { IERC20 } from "@contracts/utils/interfaces/IERC20.sol";
import { ISafe } from "@ens/interfaces/ISafe.sol";
import { ENS_Governance } from "@ens/ens.t.sol";

struct Allowance {
    uint96 amount;
    uint96 spent;
    uint16 resetTimeMin; // Maximum reset time span is 65k minutes
    uint32 lastResetMin;
    uint16 nonce;
}

interface Allowace {
    function setAllowance(
        address delegate,
        address token,
        uint96 allowanceAmount,
        uint16 resetTimeMin,
        uint32 resetBaseMin
    )
        external;

    function allowances(address owner, address delegate, address token) external view returns (Allowance memory);
}

contract Proposal_ENS_EP_6_2_Test is ENS_Governance {
    uint256 ETHbalanceBefore;
    uint256 expectedETHtransfer = 5000 * 10 ** 18;

    address receiver = 0x4F2083f5fBede34C2714aFfb3105539775f7FE64; // Endowment
    Allowace ensSafe = Allowace(0xCFbFaC74C26F8647cBDb8c5caf80BB5b32E43134);

    bytes proposalCalldata =
        hex"000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000004a000000000000000000000000000000000000000000000000000000000000000020000000000000000000000004f2083f5fbede34c2714affb3105539775f7fe640000000000000000000000004f2083f5fbede34c2714affb3105539775f7fe64000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000010f0cf064dd592000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a46a761202000000000000000000000000cfbfac74c26f8647cbdb8c5caf80bb5b32e4313400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000000a4beaeb38800000000000000000000000091c32893216de3ea0a55abb9851f581d4503d39b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001a055690d9db800000000000000000000000000000000000000000000000000000000000000008ca00000000000000000000000000000000000000000000000000000000001b7d80d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000041000000000000000000000000fe89cc7abb2c4183683ab71653c4cdc9b02d44b7000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000027ad23205b4550362e325d20456e646f776d656e7420657870616e73696f6e2028337264207472616e636865290a0a5b54656d7020436865636b20446973636f75727365206c696e6b5d2868747470733a2f2f646973637573732e656e732e646f6d61696e732f742f74656d702d636865636b2d656e646f776d656e742d657870616e73696f6e2d3372642d7472616e6368652f3139383531290a0a2320417574686f72202d206b61727061746b65790a54656d7020436865636b3a205b68747470733a2f2f646973637573732e656e732e646f6d61696e732f742f74656d702d636865636b2d656e646f776d656e742d657870616e73696f6e2d3372642d7472616e6368652f31393835315d2868747470733a2f2f646973637573732e656e732e646f6d61696e732f742f74656d702d636865636b2d656e646f776d656e742d657870616e73696f6e2d3372642d7472616e6368652f3139383531290a0a232053756d6d6172790a0a546869732070726f706f73616c2061696d7320746f20657870616e642074686520456e646f776d656e742062792066756e64696e672061207468697264207472616e6368652c20636f6d70726973696e6720352c303030204554482c2066726f6d2074686520454e532044414f20746f2074686520454e5320456e646f776d656e742e200a0a416c6f6e677369646520746865207468697264207472616e636865207472616e736665722c20616e2075706461746520746f2074686520416c6c6f77616e6365204d6f64756c65206f6e2074686520454e5320456e646f776d656e742069732070726f706f7365643b202a726573657454696d652a20666f722045544820616c6c6f77616e63652028666f7220666565207061796d656e742920697320746f206265206368616e6765642066726f6d207468652063757272656e7420706172616d65746572206f662034332c323030207365636f6e64732028333020646179732920746f2033362c303030207365636f6e6473202832352064617973292e20546865206d6f7469766174696f6e20666f722074686973206973207468617420746865726520686173206265656e20616e20616363756d756c6174696f6e206f66207061796d656e742064656c6179732c207375636820746861742063757272656e7420666565207061796d656e7473206172652064656c617965642e0a0a0a23204d6f7469766174696f6e0a0a53696e6365207468652065737461626c6973686d656e74206f662074686520456e646f776d656e74206f6e204d61726368203774682c20323032332c20454e5320686173206265656e2073657474696e672074686520676f6c64207374616e6461726420666f722044414f207472656173757279206d616e6167656d656e743a200a0a0a0a2a202a2a417373657420616c6c6f636174696f6e3a2a2a20454e532068617320746865203674682d6c61726765737420737461626c65636f696e20686f6c64696e6720616e64203574682d6c617267657374206d616a6f727320284254432c204554482920686f6c64696e6773206f6620616e792050726f746f636f6c7320285b736f757263655d2868747470733a2f2f646566696c6c616d612e636f6d2f7472656173757269657329292e0a2a202a2a496e636f6d652067656e65726174696f6e3a2a2a2053696e63652069747320696e63657074696f6e2c2074686520456e646f776d656e74206861732067656e6572617465642024322e39324d20696e204465466920726573756c747320286e6574206f6620666565732920666f7220454e532e20496e20323032342c204465466920726573756c747320726570726573656e74656420313225206f6620746f74616c20726576656e756520666f7220454e53206163636f7264696e6720746f205b454e5320526576656e7565205265706f72743a20513320323032345d2868747470733a2f2f646973637573732e656e732e646f6d61696e732f742f656e732d726576656e75652d7265706f72742d71332d323032342f3139373138292e2054686973206973206f6e20747261636b20746f77617264732074686520636f726520676f616c206f662073656c662d73756666696369656e63792e0a2a202a2a4173736574206c6f636174696f6e3a2a2a204173206f66204f63746f6265722033312c20323032342c20373125206f66207468652066756e647320776572652068656c6420696e2074686520456e646f776d656e742c207768696c65207468652072656d61696e696e672032352520776572652068656c642069646c65206163726f73732044414f2077616c6c657420616e642052656769737472617220436f6e74726f6c6c65727320285b736f757263655d2868747470733a2f2f64756e652e636f6d2f6b61727061746b65792f656e732d64616f2d66756e64666c6f7729292e0a0a0a0a546865206f726967696e616c205265717565737420666f722050726f706f73616c20696e205b5b4550322e322e345d5d2868747470733a2f2f646f63732e656e732e646f6d61696e732f64616f2f70726f706f73616c732f322e322e34292073657473206f757420746861742074686520456e646f776d656e742073686f756c642062652065737461626c6973686564206772616475616c6c79206f7665722074696d652c20696e20726573706f6e736520746f206368616e67696e6720636f6e646974696f6e7320616e64206e656564732c20616e6420746f206163686965766520746865206576656e7475616c20676f616c206f662073656c662d73756666696369656e63792e20546f2064656c69766572206f6e207468697320766973696f6e20666f722073656c662d73756666696369656e63792c2061206675727468657220696e63726561736520696e2074686520456e646f776d656e74e28099732072657475726e73206973206e65656465642e2041732074686520456e646f776d656e742069732066756c6c79207574696c697365642077697468696e2074686520626f756e6473206f6620746865206578697374696e67206d616e646174652c20697420697320636c65617220746861742074686f7365206164646974696f6e616c2072657475726e73206d75737420636f6d652066726f6d206164646974696f6e616c2066756e64732e2e205765207468696e6b202a2a6e6f772a2a206973207468652072696768742074696d6520746f20696d706c656d656e7420746865736520696e637265617365732c20676976656e2074686520666f6c6c6f77696e6720646576656c6f706d656e74733a0a0a0a0a2a202a2a50726f76656e20747261636b207265636f72642a2a3a2074686520456e646f776d656e7420686173206265656e206f7065726174696e6720666f722031207965617220616e642037206d6f6e7468732c2077697468202a6e6f2066756e6473206c6f73742e2a20447572696e6720746861742074696d652c2074686520454e5320636f6d6d756e69747920686173206761696e65642066616d696c69617269747920776974682074686520456e646f776d656e7420696e207465726d73206f6620626f7468206f7065726174696f6e7320616e6420696e6672617374727563747572652e0a2a202a2a496e766573746d656e7420506f6c6963792053746174656d656e742061732067756172647261696c732a2a3a20746865205b6e65776c792d61646f70746564204950535d2868747470733a2f2f736e617073686f742e6f72672f232f656e732e6574682f70726f706f73616c2f307830383561316534306332363466666434343536376236646365383839663539343365373263666138343432656165623831383139323631613338663062643061292070726f766964657320616e206164646974696f6e616c206c61796572206f6620636865636b7320616e642062616c616e6365732c20736f2074686174207468652044414f20616e6420697473204d657461676f7620576f726b696e672047726f75702063616e20686f6c642074686520456e646f776d656e74204d616e61676572206163636f756e7461626c652e0a2a202a2a56756c6e65726162696c697479206669782062792040426c6f636b66756c2a2a3a207269736b206f6620676f7665726e616e63652074616b656f76657220627920e2809c7269736b2d667265652076616c75652072616964657273e2809d2c2077686f20636f756c6420686176652074616b656e206f7665722074686520636f6e74726f6c206f66207468652044414f20616e642074686520456e646f776d656e742c20686173206265656e206d69746967617465642e205468652076756c6e65726162696c69747920686173206265656e2066697865642062792074686520696e74726f64756374696f6e206f6620746865205b536563757269747920436f756e63696c5d2868747470733a2f2f7777772e74616c6c792e78797a2f676f762f656e732f70726f706f73616c2f34323332393130333739373433333737373330393438383034323032393637393831313830323137323332303937393534313431343638333330303138333237333337363833393231393133332920616e64207665746f2e656e7364616f2e6574682e0a0a5468652070726f706f736564207468697264207472616e63686520776f756c642062652073697a656420617420352c303030204554482c20726570726573656e74696e672034322e3425206f66206173736574732068656c6420696e2074686520436f6e74726f6c6c657220616e64207468652044414f2057616c6c65747320282a7065722a20746865207069652063686172742061626f76652920497420776f756c6420726169736520746865206361706974616c207574696c69736174696f6e20726174652062792031302e352070657263656e7461676520706f696e74732066726f6d207468652063757272656e742037302e382520746f2038312e33252e200a0a0a2320456e646f776d656e7420557064617465730a0a0a232320557064617465730a0a4b61727061746b6579e2809973207570646174657320666f722074686520456e646f776d656e742063616e206265207365656e20686572653a205b32303233205265766965775d2868747470733a2f2f646973637573732e656e732e646f6d61696e732f742f6b61727061746b65792d323032332d7265766965772d666f722d7468652d656e732d656e646f776d656e742f3138363536292c205b31482032303234205265766965775d2868747470733a2f2f646973637573732e656e732e646f6d61696e732f742f6b61727061746b65792d68312d323032342d7265766965772d666f722d7468652d656e732d656e646f776d656e742f3139333934292e200a0a4d6f6e74686c79207265706f727473206f6e2074686520456e646f776d656e742063616e20626520666f756e64206f6e206b61727061746b6579e2809973207765627369746520285b686572655d2868747470733a2f2f7265706f7274732e6b61727061746b65792e636f6d2f656e733f6d6f6e74683d3926796561723d323032342663757272656e63793d55534429292e0a0a0a23232057686174e2809973206265656e20646f6e650a0a0a0a2a202a2a496e766573746d656e7420506f6c6963792053746174656d656e742a2a3a206b61727061746b657920686173206372656174656420616e64205b666f726d616c6c7920696e74726f64756365645d2868747470733a2f2f736e617073686f742e6f72672f232f656e732e6574682f70726f706f73616c2f3078303835613165343063323634666664343435363762366463653838396635393433653732636661383434326561656238313831393236316133386630626430612920616e205b496e766573746d656e7420506f6c6963792053746174656d656e745d2868747470733a2f2f64726976652e676f6f676c652e636f6d2f66696c652f642f317a7356306b334a37733251414a556f5778506e427046365841475731487544362f766965772920776869636820646566696e657320746865206b657920726f6c65732c20726573706f6e736962696c697469657320616e64206c696d69746174696f6e73206f662074686520456e646f776d656e7420616e6420697473204d616e616765722e20200a2a202a2a5269736b204d616e6167656d656e7420446576656c6f706d656e742a2a3a206b61727061746b6579206861732064657369676e656420616e6420696d706c656d656e746564206120726f62757374207269736b206d616e6167656d656e7420737461636b2c206c657665726167696e67206f6e20646564696361746564207269736b206461746120736572766963652070726f7669646572732c20696e636c7564696e67205b48797065726e61746976655d2868747470733a2f2f7777772e68797065726e61746976652e696f2f2920616e64205b5265646566696e655d2868747470733a2f2f7265646566696e652e6e65742f292e205468726f756768207765656b6c79206d656574696e677320776974682048797065726e61746976652c206b61727061746b657920697320636f6e74696e756f75736c792066696e652d74756e696e67207269736b20616c6572747320616e64206d616e6167656d656e742c20657370656369616c6c7920746f20636f7665722070726f746f636f6c207269736b732e204175746f6d617469632c207265616c2d74696d65207269736b20616c657274732068656c70206d6974696761746520706f74656e7469616c207269736b732e2044657461696c656420706c616e7320666f722074686520456e646f776d656e74e280997320656d657267656e63792070726f746f636f6c20616e642077617220726f6f6d2061726520696e20706c61636520746f2061737365737320616e6420726561637420746f20757267656e7420736974756174696f6e732e0a2a202a2a496e66726173747275637475726520446576656c6f706d656e742a2a3a206b61727061746b65792068617320776f726b6564207665727920636c6f73656c79207769746820476e6f736973204775696c6420746f20646576656c6f70205b616e6420696d706c656d656e745d2868747470733a2f2f646973637573732e656e732e646f6d61696e732f742f65702d352d31322d726f6c65732d6d6f6469666965722d76322d6d6967726174696f6e2d757064617465732d746f2d656e646f776d656e742d7065726d697373696f6e732f3139313733292c205a6f6469616320526f6c6573204d6f6469666965722076322e20417320612064657369676e20706172746e65722c206b61727061746b65792070726f766964656420666565646261636b20616c6c6f77696e67205a6f6469616320526f6c6573204d6f64696669657220746f206265636f6d65206d6f726520757365722d667269656e646c7920616e6420666c657869626c652e204f6e65206e6f7461626c6520696d70726f76656d656e74206973207065726d697373696f6e732075706461746573207573657220696e746572666163652c20656e68616e63696e67207472616e73706172656e637920616e642073696d706c696679696e672061756469747320666f722074686520454e5320636f6d6d756e6974792e204120636f6465207265766965772077617320616c736f20636f6e64756374656420666f72207065726d697373696f6e73207570646174652e0a2a202a2a5065726d697373696f6e7320557064617465732a2a3a2074686520456e646f776d656e7420686173206265656e20756e646572676f696e6720636f6e74696e756f7573207065726d697373696f6e7320757064617465732c20616c6c6f77696e6720697420746f20737461792075702d746f2d646174652077697468206368616e67696e67206d61726b6574206c616e64736361706520616e642070726f746f636f6c7320285b5b455020342e315d2868747470733a2f2f646973637573732e656e732e646f6d61696e732f742f65702d342d312d65786563757461626c652d617070726f76652d667572746865722d616374696f6e732d616e642d737472617465676965732d666f722d7468652d656e646f776d656e742f3137343036295d2c205b5b455020342e325d2868747470733a2f2f646973637573732e656e732e646f6d61696e732f742f342d322d65786563757461626c652d66756e642d7468652d656e646f776d656e742d7365636f6e642d7472616e6368652f3137373433295d2c205b5b455020342e355d2868747470733a2f2f646973637573732e656e732e646f6d61696e732f742f65702d342d352d65786563757461626c652d656e646f776d656e742d7065726d697373696f6e732d746f2d6b61727061746b65792d7570646174652d332f3138303336295d2c205b5b455020352e31325d2868747470733a2f2f646973637573732e656e732e646f6d61696e732f742f65702d352d31322d726f6c65732d6d6f6469666965722d76322d6d6967726174696f6e2d757064617465732d746f2d656e646f776d656e742d7065726d697373696f6e732f3139313733295d2c205b5b455020352e31345d2868747470733a2f2f646973637573732e656e732e646f6d61696e732f742f65702d352d31342d65786563757461626c652d656e646f776d656e742d7065726d697373696f6e732d746f2d6b61727061746b65792d7570646174652d342f3139353033295d292e20496e646570656e64656e742c207468697264706172747920736563757269747920726576696577206f66206f7572205065726d697373696f6e7320557064617465732068617320616c736f206265656e20636f6e647563746564206279205b54686972642047756172645d2868747470733a2f2f746869726467756172642e636f6d2f292c20776974682074686520636f737420636f7665726564206279206b61727061746b65792e0a2a202a2a44756e652044617368626f6172647320446576656c6f706d656e743a2a2a20612076617269657479206f6620646966666572656e742044756e652064617368626f617264732068617665206265656e206372656174656420746f2067697665207075626c6963207669736962696c697479206f766572207468652044414f20616e642074686520456e646f776d656e742c20616e642074686569722072657370656374697665206f7065726174696f6e732e20546865736520696e636c7564653a20746865205b44414f20676f7665726e616e63652064617368626f6172645d2868747470733a2f2f64756e652e636f6d2f6b61727061746b65792f656e732d64616f2d676f7665726e616e63652920286279206b61727061746b6579292c20746865205b66756e6420666c6f772064617368626f6172645d2868747470733a2f2f64756e652e636f6d2f6b61727061746b65792f656e732d64616f2d66756e64666c6f772920286279206b61727061746b65792920616e6420746865205b66696e616e6369616c207265706f7274696e672064617368626f6172645d2868747470733a2f2f64756e652e636f6d2f737465616b686f7573652f656e732d737465616b686f757365292028627920537465616b686f757365290a2a202a2a5265706f7274696e673a2a2a207765656b6c7920456e646f776d656e74207570646174657320616e64206d6f6e74686c792066696e616e6369616c2075706461746573206172652070726f766964656420647572696e67207468652044414fe2809973204d657461676f76206d656574696e67732e204d6f6e74686c7920456e646f776d656e7420757064617465732061726520616c736f20617661696c61626c65206f6e20746865206b61727061746b6579205b776562736974655d2868747470733a2f2f7265706f7274732e6b61727061746b65792e636f6d2f656e733f6d6f6e74683d3926796561723d323032342663757272656e63793d555344292e204269616e6e75616c20456e646f776d656e742075706461746573206172652070726f7669646564206f6e20454e5320666f72756d2e0a2a202a2a506172746e657273686970733a2a2a206b61727061746b657920686173206e65676f74696174656420616e642070757420696e20706c61636520612070726f746f636f6c2066656573207265626174652061677265656d656e74207769746820537461646572204c6162732e0a0a0a23232046757475726520706c616e730a0a0a0a2a202a2a5269736b204d616e6167656d656e742a2a3a20746f20667572746865722070726f746563742074686520456e646f776d656e7420616761696e737420706f74656e7469616c206861636b7320616e64206578706c6f69747320696e2070726f746f636f6c7320746861742074686520456e646f776d656e74206465706c6f79732066756e647320696e2c206b61727061746b657920686173206265656e20646576656c6f70696e6720477561726469616e7320616e6420e280984167696c6520457865637574696f6e20417070e280992c207768696368206175746f6d61746963616c6c792064657465637420706f74656e7469616c206578706c6f6974206576656e747320616e6420657869742061742d7269736b20706f736974696f6e732e0a2a202a2a5065726d697373696f6e7320557064617465732a2a3a2054686520456e646f776d656e742077696c6c20756e646572676f20636f6e74696e756f7573207065726d697373696f6e7320757064617465732e20496d6d656469617465207072696f72697469657320696e636c75646520696e74726f647563696e67206f7468657220737461626c65636f696e7320616e6420525741732c206f6e626f617264696e67206e6577206c6971756964207374616b696e672070726f746f636f6c7320616e64206b656570696e6720746865207065726d697373696f6e73207570646174656420776974682070726f746f636f6c2f636f6e74726163742075706772616465732e200a2a202a2a506172746e657273686970732a2a3a207265696e666f726365207969656c647320776974686f75742074616b696e67206164646974696f6e616c207269736b20627920666f726d756c6174696e6720706172746e657273686970206465616c73206c657665726167696e67206b61727061746b6579e28099732044654669206e6574776f726b2e0a2a202a2a416e616c79736973206f6e20476f7665726e616e63652041747461636b3a2a2a206b61727061746b65792c20746f67657468657220776974682074686520454e5320636f6d6d756e6974792c2077696c6c20636f6e64756374206675727468657220726573656172636820696e746f20706f74656e7469616c20676f7665726e616e63652061747461636b20766563746f7273207468617420636f756c64207075742074686520456e646f776d656e74206174207269736b2c20616e642070726573656e7420706f74656e7469616c20736f6c7574696f6e7320746f207468652044414f2e0a0a0a232053706563696669636174696f6e0a0a312e2046756e64205472616e73666572200a45786563757465642062792074686520454e532044414f204d756c746973696720287061796c6f616420617661696c61626c65205b686572655d2868747470733a2f2f676973742e6769746875622e636f6d2f4a65726f6e696d6f486f756c696e2f383139353437383730386538383833306465396161626662363762633837313029292e0a5472616e7366657220352c3030302045544820746f2074686520456e646f776d656e742028307834463230383366356642656465333443323731346146666233313035353339373735663746453634290a56616c75653a20353030303030303030303030303030303030303030300a0a0a0a332e2055706461746520746865205b416c6c6f77616e6365204d6f64756c655d2868747470733a2f2f65746865727363616e2e696f2f616464726573732f30784346624661433734433236463836343763424462386335636166383042423562333245343331333429200a45786563757465642062792074686520454e5320456e646f776d656e742e0a43757272656e746c792c2074686520706172616d6574657273206f6620416c6c6f77616e6365204d6f64756c652061726520617320666f6c6c6f77733a20616c6c6f77616e6365203d203330204554482c20726573657454696d654d696e203d203433323030207365636f6e6473202833302064617973292e2044756520746f207061796d656e742064656c61797320696e2074686520706173742c20776520776f756c64206c696b6520746f2070726f706f73652061206368616e676520696e205b726573657454696d654d696e5d2868747470733a2f2f65746865727363616e2e696f2f616464726573732f307843466246614337344332364638363437634244623863356361663830424235623332453433313334237772697465436f6e74726163742346362920706172616d657465722c20692e652e204368616e676520746865205b726573657454696d654d696e5d2868747470733a2f2f65746865727363616e2e696f2f616464726573732f307843466246614337344332364638363437634244623863356361663830424235623332453433313334237772697465436f6e74726163742346362920666f72205b6d61696e2e6d672e77672e656e732e6574685d2868747470733a2f2f65746865727363616e2e696f2f616464726573732f3078393163333238393332313664453365413061353541426239383531663538316434353033643339622920696e2074686520416c6c6f77616e6365204d6f64756c652066726f6d203330206461797320746f20323520646179732028692e652e203433323030206d696e7574657320746f203336303030292e200a0a0a6060600a20202020202264656c6567617465223a2022307839316333323839333231366445336541306135354142623938353166353831643435303364333962222c0a202020202022746f6b656e223a2022307830303030303030303030303030303030303030303030303030303030303030303030303030303030222c0a202020202022616c6c6f77616e6365416d6f756e74223a20223330303030303030303030303030303030303030222c0a202020202022726573657454696d654d696e223a202234333230302220e286922020223336303030222c0a2020202020227265736574426173654d696e223a20223238383235363133220a6060600a0a5061796c6f616420617661696c61626c65205b686572655d2868747470733a2f2f676973742e6769746875622e636f6d2f4a65726f6e696d6f486f756c696e2f3365313034313161633664343062366534303837666335396466323731396435292e200a2843616e20626520646f776e6c6f616465642c20756e7a69707065642c20616e642064726f7070656420696e746f205b53616665e2809973207472616e73616374696f6e206275696c6465725d2868747470733a2f2f6170702e736166652e676c6f62616c2f617070732f6f70656e3f736166653d6574683a3078344632303833663566426564653334433237313461466662333130353533393737356637464536342661707055726c3d6874747073253341253246253246617070732d706f7274616c2e736166652e676c6f62616c25324674782d6275696c64657229292e0a0a0a54656e6465726c792073696d756c6174696f6e20617661696c61626c65205b686572655d2868747470733a2f2f64617368626f6172642e74656e6465726c792e636f2f7075626c69632f736166652f736166652d617070732f73696d756c61746f722f30326164643763392d306666632d343964632d623337322d333066636539306363663964292e00000000000000000000000000000000000000";

    function _selectFork() public override {
        vm.createSelectFork({ blockNumber: 21_724_691, urlOrAlias: "mainnet" });
    }

    function _proposer() public pure override returns (address) {
        return 0xe52C39327FF7576bAEc3DBFeF0787bd62dB6d726; // 5pence.eth
    }

    function _beforeExecution() public override {
        ETHbalanceBefore = address(timelock).balance;
    }

    function _generateCallData()
        public
        override
        returns (address[] memory, uint256[] memory, string[] memory, bytes[] memory, string memory)
    {
        (targets, values, calldatas, description) =
            abi.decode(proposalCalldata, (address[], uint256[], bytes[], string));

        bytes[] memory internalCalldatas = new bytes[](2);
        internalCalldatas[0] = new bytes(0);

        bytes memory callData = abi.encodeWithSelector(
            Allowace.setAllowance.selector,
            0x91c32893216dE3eA0a55ABb9851f581d4503d39b,
            0x0000000000000000000000000000000000000000,
            30 ether,
            36_000,
            28_825_613
        );

        internalCalldatas[1] = abi.encodeWithSelector(
            ISafe.execTransaction.selector,
            address(ensSafe),
            0,
            callData,
            0,
            0,
            0,
            0,
            0x0000000000000000000000000000000000000000,
            0x0000000000000000000000000000000000000000,
            hex"000000000000000000000000fe89cc7abb2c4183683ab71653c4cdc9b02d44b7000000000000000000000000000000000000000000000000000000000000000001"
        );

        bytes memory expectedCalldata = abi.encode(targets, values, internalCalldatas, description);

        assertEq(calldatas, internalCalldatas);
        assertEq(proposalCalldata, expectedCalldata);

        return (targets, values, signatures, calldatas, description);
    }

    function _afterExecution() public view override {
        uint256 ETHbalanceAfter = address(timelock).balance;
        assertEq(ETHbalanceBefore, ETHbalanceAfter + expectedETHtransfer);

        Allowance memory allowance = ensSafe.allowances(
            receiver,
            address(0x91c32893216dE3eA0a55ABb9851f581d4503d39b),
            address(0x0000000000000000000000000000000000000000)
        );

        assertEq(allowance.amount, 30 ether);
        assertEq(allowance.spent, 0);
        assertEq(allowance.resetTimeMin, 36_000);
        assertEq(allowance.lastResetMin, 28_969_613);
    }

    function _isProposalSubmitted() public pure override returns (bool) {
        return true;
    }
}
